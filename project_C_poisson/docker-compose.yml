version: '3.8'

services:
  hh_experiment:
    build: .
    container_name: hh_reservoir_experiment
    volumes:
      - ./results:/app/results
      - ./cache:/app/cache
      - ./configs:/app/configs
    deploy:
      resources:
        limits:
          cpus: '0.8' # 80% of available CPUs (will be calculated dynamically)
          memory: '0.8' # 80% of available RAM (will be calculated dynamically)
    environment:
      - PYTHONUNBUFFERED=1
      - OMP_NUM_THREADS=1
      - OPENBLAS_NUM_THREADS=1
      - MKL_NUM_THREADS=1
    command: python3 src/run_experiment.py --config configs/production_config.yaml
